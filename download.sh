#! /bin/bash

CURRENT_DIR=`pwd`
rm -fr $CURRENT_DIR/cve-list-tmp/ 
mkdir -p $CURRENT_DIR/cve-list-tmp/

#wget http://cve.mitre.org/data/downloads/allitems.txt

IFS=""
CVENUM=''

CVE_SUB_STR='Name: CVE-'
SPLIT_STR='============================================'

while read line;
do
  if [[ $line == $CVE_SUB_STR* ]]
  then
     CVENUM=`echo $line|awk '{print $2}'`
  fi

  if [[ $line == $SPLIT_STR* ]]
  then
     CVENUM=''
  else
     if [ $CVENUM ]
     then
        echo $line >> $CURRENT_DIR/cve-list-tmp/$CVENUM
     fi
  fi

done < $CURRENT_DIR/allitems.txt

cd $CURRENT_DIR/cve-list-tmp/
ls  $CURRENT_DIR/cve-list-tmp/ | grep CVE| while read line ; do   echo ${line%-*}; done |sort -n | uniq | \
while read line;
do
  mkdir -p $CURRENT_DIR/cve-list-tmp/$line
  ls $CURRENT_DIR/cve-list-tmp/| grep $line-| xargs -I '{}' mv {}  $CURRENT_DIR/cve-list-tmp/$line
done

